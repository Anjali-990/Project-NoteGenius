{% extends "index.html" %}
{% load static %}
{% block main %}

<section class="upload-section container">
  <div class="upload-card mx-auto">
    <h3 class="text-center">Upload Video to Generate Notes</h3>
    <p class="text-center text-muted">
      Upload your video or record a clip. Our AI will extract audio, convert it to text, and generate summarized notes.
    </p>

    <form id="videoUploadForm">

      <!-- Drop Area -->
      <div class="drop-area text-center">
        <i class="fas fa-video"></i>
        <h6>Drag & Drop your video file here</h6>
        <p class="text-muted mb-1">or click below to select</p>

        <input
          type="file"
          class="form-control mt-2"
          accept="video/*,.mp4,.mkv,.mov"
          id="videoInput"
        />
      </div>

      <!-- Record Video -->
      <div class="my-3">
        <label class="form-label fw-semibold text-secondary">
          Or record a short video:
        </label>

        <div class="d-flex flex-wrap gap-2">
          <button type="button" id="startVideoRecord" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-circle-dot me-2"></i> Start Recording
          </button>

          <button type="button" id="stopVideoRecord" class="btn btn-outline-danger btn-sm" disabled>
            <i class="fas fa-square me-2"></i> Stop
          </button>
        </div>

        <video id="videoPreview" controls class="mt-3 w-100 d-none"></video>
      </div>

      <button type="submit" class="generate-btn w-100">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generate Notes
      </button>
    </form>

    <div class="result-section d-none" id="videoResultSection">
      <h5 class="mt-4">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generated Notes:
      </h5>
      <p class="mt-2">â€¢ Extracted and summarized notes will appear here.</p>
    </div>
  </div>
</section>

<script>
  // ðŸŽ¥ Simple video recording (optional)
  let videoRecorder;
  let videoChunks = [];

  const startVideo = document.getElementById("startVideoRecord");
  const stopVideo = document.getElementById("stopVideoRecord");
  const preview = document.getElementById("videoPreview");

  startVideo.addEventListener("click", async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    videoRecorder = new MediaRecorder(stream);

    videoChunks = [];
    videoRecorder.start();

    startVideo.disabled = true;
    stopVideo.disabled = false;

    videoRecorder.ondataavailable = (e) => {
      videoChunks.push(e.data);
    };
  });

  stopVideo.addEventListener("click", () => {
    videoRecorder.stop();

    stopVideo.disabled = true;
    startVideo.disabled = false;

    videoRecorder.onstop = () => {
      const videoBlob = new Blob(videoChunks, { type: "video/mp4" });
      const url = URL.createObjectURL(videoBlob);

      preview.src = url;
      preview.classList.remove("d-none");

      // Optional: send videoBlob to backend
    };
  });
</script>

{% endblock %}
