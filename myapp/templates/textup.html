{% extends "index.html" %}
{% block main %}

<div class="container upload-section">
  <div class="upload-card">

    <h3 class="mb-2">Upload Text to Generate Notes</h3>
    <p class="text-muted">
      Paste your content or upload a text file. Our AI assistant will summarize
      and create structured notes for you.
    </p>

    <form id="uploadForm" method="POST" enctype="multipart/form-data" action="{% url 'textup' %}">
      {% csrf_token %}

      <!-- DROP AREA -->
      <div class="drop-area mt-3">
        <i class="fas fa-cloud-arrow-up upload-icon"></i>
        <h6 class="mt-2">Drag & Drop your text file here</h6>
        <p class="text-muted small">or click below to choose a file</p>
        <input type="file" class="form-control mt-2" name="file" />
      </div>

      <!-- TEXT AREA -->
      <div class="my-3">
        <label class="form-label fw-semibold text-secondary">
          Or paste your text below:
        </label>
        <textarea
          class="form-control"
          rows="6"
          name="content"
          placeholder="Paste your content here..."
        ></textarea>
      </div>

      <!-- BUTTON -->
      <button id="generateBtn" class="generate-btn w-100" type="submit">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generate Notes
      </button>
    </form>

    <!-- WARNING -->
    {% if warning %}
    <div class="mt-3 p-3 bg-warning text-dark rounded">
      {{ warning }}
    </div>
    {% endif %}

    <!-- ERROR -->
    {% if error %}
    <div class="mt-3 p-3 bg-danger text-white rounded">
      {{ error }}
    </div>
    {% endif %}

    <!-- SUMMARY + EVALUATION -->
    {% if summary %}
<div class="notes-eval-container">

  <!-- LEFT SIDE -->
  <div class="notes-section">

    <div class="summary-box p-3 bg-dark text-light rounded shadow" style="text-align: justify;">

      <h5 class="mb-3">Your Generated Notes</h5>

      <div class="mb-3">
        <h6>‚≠ê Short Summary</h6>
        <p>{{ summary.short_summary }}</p>
      </div>

      <div class="mb-3">
        <h6>‚≠ê Bullet Points</h6>
        <ul>
          {% for b in summary.bullets %}
          <li>{{ b }}</li>
          {% empty %}
          <li>No bullet points generated.</li>
          {% endfor %}
        </ul>
      </div>

      <div class="mb-3">
        <h6>‚≠ê Detailed Explanation</h6>
        <p style="white-space: pre-line;">
          {{ summary.detailed_explanation }}
        </p>
      </div>

      <div class="mb-3">
        <h6>‚≠ê Key Terms</h6>
        <p>{{ summary.key_terms|join:", " }}</p>
      </div>

      <div class="d-flex gap-2 mt-3">
        <a href="{% url 'download_pdf' %}" class="btn btn-primary w-50">Export as PDF</a>
        <a href="{% url 'download_docx' %}" class="btn btn-outline-primary w-50">Export as Word</a>
      </div>

      <form action="{% url 'save_notes' %}" method="POST" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="notes_data" value="{{ summary.detailed_explanation|escape }}" />
        <input type="hidden" name="note_type" value="text" />
        <input type="hidden" name="title" value="{{ summary.short_summary|truncatechars:60 }}" />
        <button class="btn btn-success w-100">üíæ Save Notes</button>
      </form>

    </div>

  </div>

  <!-- RIGHT SIDE -->
  {% if evaluation %}
  <div class="evaluation-section">

    <div class="evaluation-box p-3 rounded shadow">

      <h6 class="mb-3">üìä Evaluation Criteria</h6>

      <p><strong>ROUGE-1:</strong> {{ evaluation.rouge1 }}%</p>
      <p><strong>ROUGE-L:</strong> {{ evaluation.rougeL }}%</p>
      <p><strong>Compression Ratio:</strong> {{ evaluation.compression }}%</p>

    </div>

  </div>
  {% endif %}

</div>
{% endif %}
  </div>
</div>

<!-- PROCESSING SPINNER -->
<script>
document.addEventListener("DOMContentLoaded", function() {

  const form = document.getElementById("uploadForm");
  const btn = document.getElementById("generateBtn");

  if (!form || !btn) return;

  form.addEventListener("submit", function() {
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processing...';
  });

});
</script>

{% endblock %}