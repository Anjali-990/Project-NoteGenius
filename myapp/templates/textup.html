{% extends "index.html" %}
{% block main %}

<div class="container upload-section">
  <div class="upload-card">
    <h3 class="mb-2">Upload Text to Generate Notes</h3>
    <p class="text-muted">
      Paste your content or upload a text file. Our AI assistant will summarize
      and create structured notes for you.
    </p>

    <form id="uploadForm" method="POST" enctype="multipart/form-data" action="{% url 'textup' %}">
      {% csrf_token %}

      <!-- DROP AREA -->
      <div class="drop-area mt-3">
        <i class="fas fa-cloud-arrow-up upload-icon"></i>
        <h6 class="mt-2">Drag & Drop your text file here</h6>
        <p class="text-muted small">or click below to choose a file</p>
        <input type="file" class="form-control mt-2" id="fileInput" name="file" />
      </div>

      <!-- TEXT AREA -->
      <div class="my-3">
        <label class="form-label fw-semibold text-secondary">Or paste your text below:</label>
        <textarea
          class="form-control"
          rows="6"
          name="content"
          placeholder="Paste your content here..."
        ></textarea>
      </div>

      <!-- BUTTON -->
      <button id="generateBtn" class="generate-btn w-100" type="submit">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generate Notes
      </button>
    </form>

    <!-- SHOW WARNING -->
    {% if warning %}
    <div class="mt-3 p-3 bg-warning text-dark rounded">
      <p>{{ warning }}</p>
    </div>
    {% endif %}

    <!-- SHOW ERROR -->
    {% if error %}
    <div class="mt-3 p-3 bg-danger text-white rounded">
      <p>{{ error }}</p>
    </div>
    {% endif %}

    <!-- SHOW STRUCTURED SUMMARY -->
    {% if summary %}
    <div class="summary-box mt-4 p-3 bg-dark text-light rounded shadow" style="text-align: justify;>

      <h5 class="mb-3">Your Generated Notes</h5>

      <!-- Short Summary -->
      <div class="mb-3">
        <h6>‚≠ê Short Summary</h6>
        <p>{{ summary.short_summary }}</p>
      </div>

      <!-- Bullet Points -->
      <div class="mb-3">
        <h6>‚≠ê Bullet Points</h6>
        <ul>
          {% for b in summary.bullets %}
          <li>{{ b }}</li>
          {% empty %}
          <li>No bullet points generated.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Detailed Explanation -->
      <div class="mb-3">
        <h6>‚≠ê Detailed Explanation</h6>
        <p>{{ summary.detailed_explanation }}</p>
      </div>

      <!-- Key Terms (Comma Format) -->
      <div class="mb-3">
        <h6>‚≠ê Key Terms</h6>
        <p>{{ summary.key_terms|join:", " }}</p>
      </div>

      <!-- Export Buttons -->
      <div class="d-flex gap-2 mt-3">
        <a href="{% url 'download_pdf' %}" class="btn btn-primary w-50">
          <i class="fas fa-file-pdf me-1"></i> Export as PDF
        </a>
        <a href="{% url 'download_docx' %}" class="btn btn-outline-primary w-50">
          <i class="fas fa-file-word me-1"></i> Export as Word
        </a>
      </div>

      <!-- SAVE BUTTON -->
      <form action="{% url 'save_notes' %}" method="POST" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="notes_data" value="{{ summary.detailed_explanation|escape }}" />
        <input type="hidden" name="note_type" value="text" />
        <input type="hidden" name="title" value="{{ summary.short_summary|truncatechars:60 }}" />
        <button class="btn btn-success w-100">üíæ Save Notes in Website</button>
      </form>

    </div>
    {% endif %}

  </div>
</div>

<!-- ‚úÖ Processing Spinner Script -->
<script>
document.addEventListener("DOMContentLoaded", function() {

  const form = document.getElementById("uploadForm");
  const btn = document.getElementById("generateBtn");

  if (!form || !btn) return;

  form.addEventListener("submit", function() {
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processing...';
  });

});
</script>

{% endblock %}