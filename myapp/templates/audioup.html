{% extends "index.html" %}
{% load static %}
{% block main %}

<!-- Main Content -->
<section class="upload-section">
  <div class="upload-card">
    <h3>Upload Audio to Generate Notes</h3>
    <p>
      Upload your audio file or record your voice. Our AI assistant will process
      the speech and convert it into clean, structured notes.
    </p>

    <form id="audioUploadForm">
      <div class="drop-area">
        <i class="fas fa-microphone-lines"></i>
        <h6>Drag & Drop your audio file here</h6>
        <p class="text-muted">or click below to select</p>

        <input
          type="file"
          class="form-control mt-2"
          accept="audio/*,.mp3,.wav,.m4a"
          id="audioInput"
        />
      </div>

      <!-- Optional: Record Audio -->
      <div class="my-3 text-start">
        <label class="form-label fw-semibold text-secondary">
          Or record your voice:
        </label>

        <div class="d-flex gap-2">
          <button
            type="button"
            id="startRecord"
            class="btn btn-sm btn-outline-primary"
          >
            <i class="fas fa-circle-dot me-2"></i> Start Recording
          </button>

          <button
            type="button"
            id="stopRecord"
            class="btn btn-sm btn-outline-danger"
            disabled
          >
            <i class="fas fa-square me-2"></i> Stop
          </button>
        </div>

        <audio
          id="audioPreview"
          controls
          class="mt-3 w-100 d-none"
        ></audio>
      </div>

      <button type="submit" class="generate-btn w-100">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generate Notes
      </button>
    </form>

    <div class="result-section d-none" id="audioResultSection">
      <h5 class="mt-4">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generated Notes:
      </h5>
      <p class="mt-2">
        â€¢ Extracted notes from your audio will appear here after processing.
      </p>
    </div>
  </div>
</section>

<script>
  // ðŸŽ™ï¸ Basic Audio Recording (Optional)
  let mediaRecorder;
  let audioChunks = [];

  const startBtn = document.getElementById("startRecord");
  const stopBtn = document.getElementById("stopRecord");
  const audioPreview = document.getElementById("audioPreview");

  startBtn.addEventListener("click", async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);

    audioChunks = [];
    mediaRecorder.start();

    startBtn.disabled = true;
    stopBtn.disabled = false;

    mediaRecorder.ondataavailable = (e) => {
      audioChunks.push(e.data);
    };
  });

  stopBtn.addEventListener("click", () => {
    mediaRecorder.stop();

    stopBtn.disabled = true;
    startBtn.disabled = false;

    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
      const audioURL = URL.createObjectURL(audioBlob);

      audioPreview.src = audioURL;
      audioPreview.classList.remove("d-none");

      // Optional: if you want to upload recorded audio,
      // convert audioBlob â†’ File and attach to form
    };
  });
</script>

{% endblock %}
