{% extends "index.html" %} {% load static %} {% block main %}

<section class="upload-section container">
  <div class="upload-card mx-auto">
    <h3 class="text-center">Upload Audio to Generate Notes</h3>
    <p class="text-center text-muted">
      Upload your audio file or record your voice. Our AI assistant will convert
      speech into clean notes.
    </p>

    <form id="audioUploadForm">
      <!-- Drop Area -->
      <div class="drop-area text-center">
        <i class="fas fa-microphone-lines"></i>
        <h6>Drag & Drop your audio file here</h6>
        <p class="text-muted mb-1">or click below to select</p>

        <input
          type="file"
          class="form-control mt-2"
          accept="audio/*,.mp3,.wav,.m4a"
          id="audioInput"
        />
      </div>

      <!-- Recording Section -->
      <div class="my-3">
        <label class="form-label fw-semibold text-secondary">
          Or record your voice:
        </label>

        <div class="d-flex flex-wrap gap-2">
          <button
            type="button"
            id="startRecord"
            class="btn btn-outline-primary btn-sm"
          >
            <i class="fas fa-circle-dot me-2"></i> Start Recording
          </button>

          <button
            type="button"
            id="stopRecord"
            class="btn btn-outline-danger btn-sm"
            disabled
          >
          <i class="fas fa-square me-2" style="color: #dc3545 !important; opacity: 1 !important;"></i> 
          <span style="color: #dc3545 !important; font-weight: bold; opacity: 1 !important;">Stop</span>
          </button>
          </button>
        </div>

        <audio id="audioPreview" controls class="mt-3 w-100 d-none"></audio>
      </div>

      <button type="submit" class="generate-btn w-100">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generate Notes
      </button>
    </form>

    <!-- Result Section -->
    <div class="result-section d-none" id="audioResultSection">
      <h5 class="mt-4">
        <i class="fas fa-wand-magic-sparkles me-2"></i> Generated Notes:
      </h5>
      <p class="mt-2">â€¢ Extracted notes from your audio will appear here.</p>
    </div>
  </div>
</section>

<script>
  let mediaRecorder;
  let audioChunks = [];

  const startBtn = document.getElementById("startRecord");
  const stopBtn = document.getElementById("stopRecord");
  const audioPreview = document.getElementById("audioPreview");

  startBtn.addEventListener("click", async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.start();

    startBtn.disabled = true;
    stopBtn.disabled = false;

    mediaRecorder.ondataavailable = (e) => {
      audioChunks.push(e.data);
    };
  });

  stopBtn.addEventListener("click", () => {
    mediaRecorder.stop();
    stopBtn.disabled = true;
    startBtn.disabled = false;

    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
      const audioURL = URL.createObjectURL(audioBlob);

      audioPreview.src = audioURL;
      audioPreview.classList.remove("d-none");
    };
  });
</script>

{% endblock %}
