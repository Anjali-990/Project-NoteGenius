{% extends "index.html" %}
{% load static %}
{% block main %}

<section class="upload-section">
  <div class="upload-card profile-card" style="max-width:900px;margin:24px auto;">
    <h3 class="text-center mb-4">Your Profile</h3>

    <form method="POST" id="profileForm">
      {% csrf_token %}

      <div class="row g-4">
        <!-- LEFT -->
        <div class="col-md-7">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="mb-3 text-center">Basic Information</h5>

              <!-- Username + Email -->
              <div class="row mb-3">
                <div class="col-sm-6">
                  <label class="form-label small">Username</label>
                  <input class="form-control" value="{{ user.username }}" readonly>
                </div>
                <div class="col-sm-6">
                  <label class="form-label small">Email</label>
                  <input class="form-control" value="{{ user.email }}" readonly>
                </div>
              </div>

              <!-- Occupation -->
              <div class="mb-3">
                <label class="form-label small">Occupation</label>
                <select class="form-select editable" name="occupation" disabled>
                  <option value="">Select</option>
                  <option {% if profile.occupation == "Student" %}selected{% endif %}>Student</option>
                  <option {% if profile.occupation == "Working Professional" %}selected{% endif %}>Working Professional</option>
                  <option {% if profile.occupation == "Teacher / Professor" %}selected{% endif %}>Teacher / Professor</option>
                  <option {% if profile.occupation == "Researcher" %}selected{% endif %}>Researcher</option>
                  <option {% if profile.occupation == "Other" %}selected{% endif %}>Other</option>
                </select>
              </div>

              <!-- Usage -->
              <div class="mb-3">
                <label class="form-label small">Using NoteGenius mostly for</label>
                <select class="form-select editable" name="usage" disabled>
                  <option value="">Choose</option>
                  <option {% if profile.usage == "Text summarisation" %}selected{% endif %}>Text summarisation</option>
                  <option {% if profile.usage == "Audio notes" %}selected{% endif %}>Audio notes</option>
                  <option {% if profile.usage == "Video notes" %}selected{% endif %}>Video notes</option>
                  <option {% if profile.usage == "Q&A generation" %}selected{% endif %}>Q&A generation</option>
                  <option {% if profile.usage == "Quiz generation" %}selected{% endif %}>Quiz generation</option>
                </select>
              </div>

              <!-- Bio -->
              <div class="mb-3">
                <label class="form-label small">Bio</label>
                <textarea class="form-control editable" rows="4" name="bio" readonly>{{ profile.bio }}</textarea>
              </div>

              <!-- Buttons -->
              <div class="d-grid">
                <button type="button" id="editBtn" class="btn btn-outline-primary">
                  Change Details
                </button>

                <button type="submit" id="saveBtn" class="btn btn-primary d-none">
                  Save Changes
                </button>
              </div>

            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="col-md-5">
          <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
              <h5>Your Activity</h5>
              <p>Total Saved Notes: <strong>{{ total_notes }}</strong></p>
              <p>Total Quizzes Generated: <strong>{{ total_quizzes }}</strong></p>
              <p>Total QnA Created: <strong>{{ total_qna }}</strong></p>
            </div>
          </div>
        </div>

      </div>
    </form>
  </div>
</section>

<script>
  const editBtn = document.getElementById("editBtn");
  const saveBtn = document.getElementById("saveBtn");
  const editableFields = document.querySelectorAll(".editable");

  editBtn.addEventListener("click", () => {
    editableFields.forEach(el => {
      el.removeAttribute("disabled");
      el.removeAttribute("readonly");
    });
    editBtn.classList.add("d-none");
    saveBtn.classList.remove("d-none");
  });
</script>

{% endblock %}
